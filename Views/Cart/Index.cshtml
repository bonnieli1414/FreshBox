@model IEnumerable<FreshBox.Models.Carts>

@{
    ViewData["Title"] = "Index";
    Layout = "_Layout";
    using var cart = new z_repoCarts();
    int int_amount = cart.GetCartTotal();
    int int_freight = (int_amount > 0) ? 60 : 0;
    int int_total = int_amount + int_freight;
}

@section Styles {
    <link rel="stylesheet" href="@Url.Content("~/vendor/rewear/css/cart-payment.css")" />
}

<main id="container">
    <div class="row wrapper">
        <div class="col-lg-12">
            <!-- è³¼ç‰©è»Š -->
            <div id="cart">
                <div class="cart-page-area">
                    <form method="post" action="#">
                        <div class="table-responsive mb-4">
                            <table class="shop_table-2 cart">
                                <thead>
                                    <tr>
                                        <th class="product-thumbnail">åœ–ç‰‡</th>
                                        @* å¥—ç”¨product-priceæ ¼å¼ *@
                                        <th class="product-price">å•†å“ç·¨è™Ÿ</th>
                                        <th class="product-name">å•†å“åç¨±</th>
                                        <th class="product-price">å–®åƒ¹</th>
                                        <th class="product-quantity">æ•¸é‡</th>
                                        <th class="product-subtotal">å°è¨ˆ</th>
                                        <th class="product-remove">åˆªé™¤</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr class="cart_item" data-cart=@item.Id>
                                            <td class="item-img">
                                                <a
                                                    href="@Url.Action("Detail" , "Product" , new {area = "" , id = item.ProdNo})">
                                                    <img src="@Url.Content($"~/images/product/{item.ProdNo}/{item.ProdNo}.jpg")"
                                                        alt="" />
                                                </a>
                                            </td>
                                            <td class="item-price prod-no">
                                                @item.ProdNo
                                            </td>
                                            <td class="item-title">
                                                <a
                                                    href="@Url.Action("Detail" , "Product" , new {area = "" , id = item.ProdNo})">
                                                    @item.ProdName
                                                </a>
                                            </td>
                                            <td class="item-price">
                                                $@item.OrderPrice
                                            </td>
                                            <td class="item-qty">
                                                <div class="cart-quantity">
                                                    <div class="cart-plus-minus">
                                                        <div class="dec qtybutton">-</div>
                                                        <input value="@item.OrderQty" name="qtybutton"
                                                            class="cart-plus-minus-box" type="text" />
                                                        <div class="inc qtybutton">+</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="total-price"><strong>$@item.OrderAmount</strong></td>
                                            <td class="remove-item">
                                                <a href="@Url.Action("DeleteCart" , "Cart" , new{area="", id = item.Id})"><i
                                                        class="fa fa-trash-o">åˆªé™¤</i></a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <div class="cart-bottom-area">
                            <div class="row">
                                <div class="col-lg-8 col-md-7">
                                    <div class="update-coupne-area">
                                        <ul>
                                            <li>
                                                1.&nbsp;&nbsp;åœ–ç‰‡åƒ…ä¾›èªªæ˜æ–¹å¼ï¼Œå•†å“ä»¥æ”¶åˆ°å¯¦ç‰©ç‚ºä¸»ã€‚ğŸ™ğŸ™
                                            </li>
                                            <li>
                                                2.&nbsp;&nbsp;è«‹æ³¨æ„âš ï¸âš ï¸å•†å“å°ºå¯¸è¦æ ¼ï¼Œä»¥å…æ”¶åˆ°ä¸åˆé©çš„å•†å“ã€‚å¦‚æœ‰éœ€è¦ï¼Œè«‹å…ˆè©¢å•å®¢æœæˆ–ç´¢å–æ›´è©³ç´°çš„å°ºå¯¸è³‡è¨Šã€‚
                                            </li>
                                            <li>
                                                3.&nbsp;&nbsp;ğŸ‘ğŸ‘è«‹ç¢ºèªæ”¶ä»¶åœ°å€å’Œè¯ç¹«æ–¹å¼çš„æ­£ç¢ºæ€§ï¼Œä»¥å…ç™¼ç”Ÿç‰©æµå•é¡Œæˆ–ç„¡æ³•è¯ç¹«åˆ°æ‚¨ã€‚
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-5">
                                    <div class="cart-total-area">
                                        <div class="sub-shipping">
                                            <p class="clearfix">å°è¨ˆ<span>$@int_amount</span></p>
                                            <p class="clearfix">é‹è²»<span>$@int_freight</span></p>
                                        </div>
                                        <div class="process-cart-total">
                                            <p>ç¸½è¨ˆ<span>$@int_total</span></p>
                                        </div>
                                        <div class="col-lg-12 d-flex justify-content-between mt-4 text-center">
                                            <div class="col-lg-6" style="width: 45%">
                                                <a class="btn-def btn2"
                                                    href="@Url.Action("Index" , "Home" , new {area = ""})"
                                                    style="display: block">ç¹¼çºŒè³¼ç‰©</a>
                                            </div>
                                            <div class="col-lg-6" style="width: 45%">
                                                <a class="btn-def btn2 btnmy"
                                                    href="@Url.Action("Payment" , "Home" , new {area = ""})"
                                                    style="display: block">å¡«å¯«ä»˜æ¬¾è³‡è¨Š</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
@section BodyScript
{
    <script>
        $(".qtybutton").on("click", function (e) {
            var $button = $(this);
            var prodNo = $button.parent().parent().parent().parent().find(".prod-no").text().trim();
            var oldValue = $button.parent().find("input").val();
            if ($button.text() == "+") {
                var newVal = parseFloat(oldValue) + 1;
            } else {
                // Don't allow decrementing below zero
                if (oldValue > 1) {
                    var newVal = parseFloat(oldValue) - 1;
                } else {
                    newVal = 1;
                }
            }
        @* $button.parent().find("input").val(newVal); *@
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=UTF-8",
                    url: '@Url.Action("UpdateQty", "Cart", new { area = "" })',
                    data: { "ProdNo": prodNo, "Qty": newVal },
                    dataType: "json",
                    success: function (res) {
                        window.location.reload();
                    },
                    error: function (err) {
                        alert('ç™¼ç”ŸéŒ¯èª¤,ç„¡æ³•æ›´æ–°è³¼ç‰©è»Š!!');
                    }
                });
        });
    </script>
}
